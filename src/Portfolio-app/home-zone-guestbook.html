<link rel="import" href="import-elements.html">
<link rel="import" href="app-styles.html">


<dom-module id="home-zone-guestbook">
  <template>
    <style is="custom-style" include="app-styles">
      :host {
        display: block;
      }

      paper-material {
        @apply(--layout-horizontal);
        padding: 10px;
        background-color: white;
        border: 1px solid #ddd;
        margin: 0 auto 10px auto;
      }

      paper-material:hover {
       /*border: 1px solid var(--paper-pink-600);*/
      }

      paper-button {
        background-color: var(--paper-pink-600);
        color: white;
        margin-top: 20px;
        margin-left: 0px;
      }

      paper-dialog.guestbook-class {
        top: 150px;
        width: 96%;
        margin: 20px;
        max-width: 400px;
        max-height: 350px;
        min-height: 350px;
      }

      iron-pages {
        margin-top: 15px;
      }

      .paper-textarea {
        /*padding-top: 25px;*/
      }

      .guestbook-page {
        height: auto;
        text-align: center; 
      }

      .guestbook-page-inner {
        min-height: 175px;
      }

      .validation-error-div {
        height: 10px; 
        text-align: center; 
        font-family: 'Roboto', sans-serif;
        color: var(--paper-red-500);
      }

      .guestbook-card {
        @apply(--layout-horizontal);
        margin: 16px 16px 0 16px;
        padding: 10px 15px 15px 15px;
        background-color: white;
        border: 1px solid #ddd;
      }

      .guestbook-inner-card {
        width: 100%;
      }

      .guestbook-avatar-div {
        height: auto;
        width: 43px;
        display: inline-block;
        margin: 0 auto;
        float: right;
        padding-right: 10px;
      }

      .guestbook-avatar-catelog {
        height: auto; 
        margin: 0 auto;
        padding-top: 30px;
        padding-bottom: 0px;
      }

      .captain-dialog-header {
        color: rgba(0, 0, 0, .7);
        font-family: 'Roboto', sans-serif;
        font-style: italic;
        font-size: 24px;
        padding-bottom: 20px;
      }

      .paper-textarea {
        padding-top: 25px;
      }

      paper-input {
        margin-bottom: 5px;
        text-align: left;
      }

      paper-textarea {
        text-align: left;
      }

      iron-list {
        height: 400px; 
        border: 1px solid #adadad;
        padding: 10px;
        background-color: #f6f6f6;
        margin-top: 15px;
      }

      .guest-name {
        font-family: 'Roboto', sans-serif;
        font-size: 17px;
        padding-bottom: 5px;
        text-align: left;
      }

      .guest-location {
        font-family: 'Roboto Condensed', sans-serif;
        font-size: 12px;
        font-style: italic;
        color: var(--paper-teal-700);
        text-align: left;
      }

      .guestbook-line {
        border: none;
        padding-bottom: 1px;
        background: linear-gradient(90deg, rgba(216,27,96,1) 0%, rgba(255,255,255,1) 93%, rgba(255,255,255,1) 100%);
        margin-top: 5px;
        margin-bottom: 5px;
      }

      .guest-message {
        font-family: 'Roboto', sans-serif;
        font-weight: 300;
        font-size: 14px;
        text-align: left;
      }

      .guestbook-entry-count {
        font-family: 'Roboto', sans-serif;
        font-size: 12px;
        color: var(--paper-teal-400);
      }

      .guestbook-entry-length {
        font-size: 16px;
        color: var(--paper-indigo-500);
      }

      .guest-likes-count {
        font-size: 12px;
        font-family: 'Roboto Condensed', sans-serif;
        padding: 0;
        margin: 0;
        color: rgb(170, 170, 170);
      }

      .iron-list-gradient {
        margin-top: -115px;
        height: 118px;
        background: linear-gradient(0deg, rgb(255, 255, 255) 0%, rgba(255,255,255,.5) 85%, rgba(255,255,255,0) 100%); 
        position: relative;
      }

      @media only screen and (max-width: 640px) {
        #guestbook {
          margin-top: 0px;
       }

       .captain-dialog-header {
          font-size: 20px;
          padding-bottom: 10px;
       }
      }

    </style>

<!-- /////////////////////////////////////////// -->
<!-- GUESTBOOK SECTION -->
<!-- /////////////////////////////////////////// -->
    <div class="commander-section white">
      <div class="commander-inner-section">
        <div class="container flex-horizontal">
          <div class="captain-header-dark-left flexchild">
            Site Guestbook
          </div>
          <div class="guestbook-entry-count child3">
            <!-- guestbook entries:<span class="guestbook-entry-length"> {{guests.length}}</span> -->
            <div class="align-right cursor-pointer" on-tap="like_guestbook">
              <div class="guest-likes-count inline">
                {{guestbooklikes.likes}} likes
              </div>
              <img style="width: 20px;" src="{{guestbooklikes.heart}}">
            </div>
          </div>
        </div>
        <hr class="captain-app-line-plain">
        <paper-dialog no-cancel-on-outside-click class="guestbook-class" id="guestbook">
        <div class="container flex-end-justified">
          <div on-tap="close_reset_dialog">
            <img style="width: 15px;" src="/images/small-icon-x.png">
          </div>
        </div>
        <iron-pages id="guestbookpages" selected="0">
          <div class="guestbook-page">
            <div class="guestbook-page-inner">
              <div class="captain-dialog-header">
                Choose an avatar.
              </div>
              <div class="guestbook-avatar-catelog">
                <div style="height: 80px; width: 80px; display: inline-block; margin: 0 auto; float: left;">
                  <img id="avatar1" style="width: 100%;" on-tap="set_avatar" src="/images/avatar-1.png">
                </div>
                <div style="height: 80px; width: 80px; display: inline-block; margin: 0 auto;">
                  <img id="avatar2" style="width: 100%;" on-tap="set_avatar" src="/images/avatar-2.png">
                </div>
                <div style="height: 80px; width: 80px; display: inline-block; margin: 0 auto; float: right;">
                  <img id="avatar3" style="width: 100%;" on-tap="set_avatar" src="/images/avatar-3.png">
                </div>
              </div>
            </div>
            <div class="validation-error-div">
              {{error}}
            </div>
            <paper-button class="captain-app-button" on-tap="next_page">
              CONTINUE
            </paper-button>
          </div>
          <div class="guestbook-page">
            <div class="guestbook-page-inner">            
              <div class="captain-dialog-header">
                Enter your name &amp; location.
              </div>
              <paper-input value="{{name}}" label="name"></paper-input>
              <paper-input value="{{location}}" label="location"></paper-input>
            </div>
            <div class="validation-error-div">
              {{error}}
            </div>
            <paper-button class="captain-app-button" style="bottom: 0;" on-tap="next_page">
              CONTINUE
            </paper-button>
          </div>
          <div class="guestbook-page">
            <div class="guestbook-page-inner">            
              <div class="captain-dialog-header">
                Leave a message.
              </div>
                <paper-textarea class="paper-textarea" value="{{message}}" label="enter your message" char-counter maxlength="50"></paper-textarea>
            </div>
            <div class="validation-error-div">
              {{error}}
            </div>
            <paper-button class="captain-app-button" on-tap="add_entry">
              ADD ENTRY TO GUESTBOOK
            </paper-button>
          </div>
        </iron-pages>
        </paper-dialog>
        <div class="commander-right-small">
          <div style="width: 100%; text-align: left; padding-bottom: 20px;">
            <div class="captain-content-dark padding-left-20px">
                Here, you can make a guest book entry, this is a custom <a href="https://www.polymer-project.org/1.0/"> Polymer </a>element. The guest list data is being saved to Firebase
            </div>
            <paper-button class="margin-left-20px captain-app-button" onclick="guestbook.open();" raised>SIGN GUESTBOOK</paper-button>
          </div>
        </div> 
        <div class="commander-left-large">
          <iron-list is="iron-list" items="{{guests}}"> 
            <template class="testing">       
              <div>
                <paper-material elevation="2">
                  <div class="guestbook-inner-card">
                    <div class="container flex-horizontal">
                      <div>
                      <div class="guestbook-avatar-div">
                        <img style="width: 100%;" src="{{item.avatar}}">
                      </div>
                      </div>
                      <div class="flexchild">
                        <div class="guest-name">
                          {{item.name}}
                        </div>
                        <div class="guest-location">
                          {{item.location}}
                        </div>
                      </div>
                      <div class="align-right cursor-pointer" on-tap="like_entry">
                        <img style="width: 20px;" src="{{item.heart}}">
                        <div class="guest-likes-count">
                          {{item.likes}} likes
                        </div>
                      </div>
                    </div>

                    <hr class="guestbook-line">
                    <div class="guest-message">
                      {{item.message}}
                    </div>
                  </div>
                </paper-material>
              </div>
            </template>
          </iron-list>
          <div class="iron-list-gradient"></div>
        </div>
      </div>
    </div>
  </template>

  <script>
    Polymer({

      is: 'home-zone-guestbook',

      properties: {
        error: {
          type: String,
          value: "",
          notify: true,
          reflectToAttribute: true          
        },

        name: {
          type: String,
          value: "",
          notify: true,
          reflectToAttribute: true
        },

        location: {
          type: String,
          value: "",
          notify: true,
          reflectToAttribute: true
        },

        message: {
          type: String,
          value: "",
          notify: true,
          reflectToAttribute: true
        },

        avatar: {
          type: String,
          value: "",
          notify: true,
          reflectToAttribute: true
        },

        guestbooklikes: {
          type: Object,
          value: {
            likes: 0,
            heart: "/images/small-icon-heart-outline.png"
          },
          notify: true,
          reflectToAttribute: true
        },

        guests: {
          type: Array,
          value: [
            {
              name: "Barbara M.",
              location: "Sacramento, California",
              message: "This is a test message to see how many characters!",
              likes: 15,
              heart: "/images/small-icon-heart-outline.png",
              avatar: "/images/avatar-1.png"
            },
            {
              name: "Gene Regonal",
              location: "Tampa Bay, Florida",
              message: "This is a test message to see how many characters!",
              likes: 11,
              heart: "/images/small-icon-heart-outline.png",
              avatar: "/images/avatar-3.png"
            },
            {
              name: "Ross Cravettes",
              location: "Portland, Maine",
              message: "This is a test message to see how many characters!",
              likes: 58,
              heart: "/images/small-icon-heart-outline.png",
              avatar: "/images/avatar-2.png"
            },
            {
              name: "Mike Douglas",
              location: "Cleveland, Ohio",
              message: "This is a test message to see how many characters!",
              likes: 45,
              heart: "/images/small-icon-heart-outline.png",
              avatar: "/images/avatar-1.png"
            },
            {
              name: "Tamara Williamson",
              location: "Santa Fe, New Mexico",
              message: "This is a test message to see how many characters!",
              likes: 14,
              heart: "/images/small-icon-heart-outline.png",
              avatar: "/images/avatar-2.png"
            },
            {
              name: "Christopher McDonald",
              location: "Seattle, Washington",
              message: "This is a test message to see how many characters!",
              likes: 153,
              heart: "/images/small-icon-heart-outline.png",
              avatar: "/images/avatar-3.png"
            },
          ],
          notify: true,
          reflectToAttribute: true
        },
      },

      like_guestbook: function() {

        if (this.guestbooklikes.heart === "/images/small-icon-heart-outline.png") {
          this.set('guestbooklikes.heart', "/images/small-icon-heart.png");
          this.set('guestbooklikes.likes', this.guestbooklikes.likes+1);

        } else if (this.guestbooklikes.heart === "/images/small-icon-heart.png") {
          this.set('guestbooklikes.heart', "/images/small-icon-heart-outline.png");
          this.set('guestbooklikes.likes', this.guestbooklikes.likes-1);
        }
      },


      close_reset_dialog: function() {
        this.$.guestbook.toggle();
        this.$.guestbookpages.selected = 0;

        // reset values
        this.set("name", "");
        this.set("location", "");
        this.set("message", "");
        this.set("avatar", "");
      },

      set_avatar: function(e) {

        // get avatar ID
        var avatar = e.currentTarget;
        var id = avatar.id;
        console.log(id);

        // set avatar property value
        if (id === "avatar1") {
          this.set("avatar", "/images/avatar-1.png");
        } else if (id === "avatar2") {
          this.set("avatar", "/images/avatar-2.png");
        } else if (id === "avatar3") {
          this.set("avatar", "/images/avatar-3.png");
        }
      },

      next_page: function() {

        // check for avatar
        this.set("error", "");

        // check for avatar
        if (this.$.guestbookpages.selected === 0 && this.avatar === "") {
          this.set("error", "Please select an avatar!");
          return;
        // check for name & location
         } else if (this.$.guestbookpages.selected === 1 && this.name === "" && this.location === "") {
          this.set("error", "Please enter a name & location!");
          return;
        // check for name
        } else if (this.$.guestbookpages.selected === 1 && this.name === "") {
          this.set("error", "Please enter a name!");
          return;
        // check for location
        } else if (this.$.guestbookpages.selected === 1 && this.location === "") {
          this.set("error", "Please enter a location!");
          return;
        }

        // change iron-pages
        this.$.guestbookpages.selectNext();
      },

      like_entry: function(e) {
        var model = e.model;
        
        console.log(model.item.heart);


        if (model.item.heart === "/images/small-icon-heart-outline.png") {
          model.set('item.heart', "/images/small-icon-heart.png");
          model.set('item.likes', model.item.likes+1);
          console.log(model.item.heart);

        } else if (model.item.heart === "/images/small-icon-heart.png") {
          model.set('item.heart', "/images/small-icon-heart-outline.png");
          model.set('item.likes', model.item.likes-1);
        }
      },

      add_entry: function() {

        // check for message 
        if (this.$.guestbookpages.selected === 2 && this.message === "") {
          this.set("error", "Please enter a message!");
          return;
        } 

        // create empty guestbook entry object
        entry = {
          name: "",
          location: "",
          message: "",
          likes: 0,
          heart: "/images/small-icon-heart-outline.png",
          avatar: ""
        };

        // set values to entry object
        entry.name = this.name;
        entry.location = this.location;
        entry.message = this.message;
        entry.avatar = this.avatar;

        // push entry object into guests array
        this.unshift('guests', entry);

        // reset values
        this.set("name", "");
        this.set("location", "");
        this.set("message", "");
        this.set("avatar", "");

        // reset iron-pages
        this.$.guestbookpages.selected = 0;

        // close guestbook
        this.$.guestbook.close();

        console.log(entry);
      },
    });
  </script>
</dom-module>